{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar isArray_1 = __importDefault(require(\"lodash/isArray\"));\n\nvar isPlainObject_1 = __importDefault(require(\"lodash/isPlainObject\"));\n\nvar assign_1 = __importDefault(require(\"lodash/assign\"));\n\nvar forEach_1 = __importDefault(require(\"lodash/forEach\"));\n\nvar map_1 = __importDefault(require(\"lodash/map\"));\n\nvar deprecate_1 = __importDefault(require(\"./deprecate\"));\n\nvar query_1 = __importDefault(require(\"./query\"));\n\nvar record_1 = __importDefault(require(\"./record\"));\n\nvar callback_to_promise_1 = __importDefault(require(\"./callback_to_promise\"));\n\nvar Table =\n/** @class */\nfunction () {\n  function Table(base, tableId, tableName) {\n    if (!tableId && !tableName) {\n      throw new Error('Table name or table ID is required');\n    }\n\n    this._base = base;\n    this.id = tableId;\n    this.name = tableName; // Public API\n\n    this.find = callback_to_promise_1.default(this._findRecordById, this);\n    this.select = this._selectRecords.bind(this);\n    this.create = callback_to_promise_1.default(this._createRecords, this);\n    this.update = callback_to_promise_1.default(this._updateRecords.bind(this, false), this);\n    this.replace = callback_to_promise_1.default(this._updateRecords.bind(this, true), this);\n    this.destroy = callback_to_promise_1.default(this._destroyRecord, this); // Deprecated API\n\n    this.list = deprecate_1.default(this._listRecords.bind(this), 'table.list', 'Airtable: `list()` is deprecated. Use `select()` instead.');\n    this.forEach = deprecate_1.default(this._forEachRecord.bind(this), 'table.forEach', 'Airtable: `forEach()` is deprecated. Use `select()` instead.');\n  }\n\n  Table.prototype._findRecordById = function (recordId, done) {\n    var record = new record_1.default(this, recordId);\n    record.fetch(done);\n  };\n\n  Table.prototype._selectRecords = function (params) {\n    if (params === void 0) {\n      params = {};\n    }\n\n    if (arguments.length > 1) {\n      console.warn(\"Airtable: `select` takes only one parameter, but it was given \" + arguments.length + \" parameters. Use `eachPage` or `firstPage` to fetch records.\");\n    }\n\n    if (isPlainObject_1.default(params)) {\n      var validationResults = query_1.default.validateParams(params);\n\n      if (validationResults.errors.length) {\n        var formattedErrors = map_1.default(validationResults.errors, function (error) {\n          return \"  * \" + error;\n        });\n        throw new Error(\"Airtable: invalid parameters for `select`:\\n\" + formattedErrors.join('\\n'));\n      }\n\n      if (validationResults.ignoredKeys.length) {\n        console.warn(\"Airtable: the following parameters to `select` will be ignored: \" + validationResults.ignoredKeys.join(', '));\n      }\n\n      return new query_1.default(this, validationResults.validParams);\n    } else {\n      throw new Error('Airtable: the parameter for `select` should be a plain object or undefined.');\n    }\n  };\n\n  Table.prototype._urlEncodedNameOrId = function () {\n    return this.id || encodeURIComponent(this.name);\n  };\n\n  Table.prototype._createRecords = function (recordsData, optionalParameters, done) {\n    var _this = this;\n\n    var isCreatingMultipleRecords = isArray_1.default(recordsData);\n\n    if (!done) {\n      done = optionalParameters;\n      optionalParameters = {};\n    }\n\n    var requestData;\n\n    if (isCreatingMultipleRecords) {\n      requestData = {\n        records: recordsData\n      };\n    } else {\n      requestData = {\n        fields: recordsData\n      };\n    }\n\n    assign_1.default(requestData, optionalParameters);\n\n    this._base.runAction('post', \"/\" + this._urlEncodedNameOrId() + \"/\", {}, requestData, function (err, resp, body) {\n      if (err) {\n        done(err);\n        return;\n      }\n\n      var result;\n\n      if (isCreatingMultipleRecords) {\n        result = body.records.map(function (record) {\n          return new record_1.default(_this, record.id, record);\n        });\n      } else {\n        result = new record_1.default(_this, body.id, body);\n      }\n\n      done(null, result);\n    });\n  };\n\n  Table.prototype._updateRecords = function (isDestructiveUpdate, recordsDataOrRecordId, recordDataOrOptsOrDone, optsOrDone, done) {\n    var _this = this;\n\n    var opts;\n\n    if (isArray_1.default(recordsDataOrRecordId)) {\n      var recordsData = recordsDataOrRecordId;\n      opts = isPlainObject_1.default(recordDataOrOptsOrDone) ? recordDataOrOptsOrDone : {};\n      done = optsOrDone || recordDataOrOptsOrDone;\n      var method = isDestructiveUpdate ? 'put' : 'patch';\n      var requestData = assign_1.default({\n        records: recordsData\n      }, opts);\n\n      this._base.runAction(method, \"/\" + this._urlEncodedNameOrId() + \"/\", {}, requestData, function (err, resp, body) {\n        if (err) {\n          done(err);\n          return;\n        }\n\n        var result = body.records.map(function (record) {\n          return new record_1.default(_this, record.id, record);\n        });\n        done(null, result);\n      });\n    } else {\n      var recordId = recordsDataOrRecordId;\n      var recordData = recordDataOrOptsOrDone;\n      opts = isPlainObject_1.default(optsOrDone) ? optsOrDone : {};\n      done = done || optsOrDone;\n      var record = new record_1.default(this, recordId);\n\n      if (isDestructiveUpdate) {\n        record.putUpdate(recordData, opts, done);\n      } else {\n        record.patchUpdate(recordData, opts, done);\n      }\n    }\n  };\n\n  Table.prototype._destroyRecord = function (recordIdsOrId, done) {\n    var _this = this;\n\n    if (isArray_1.default(recordIdsOrId)) {\n      var queryParams = {\n        records: recordIdsOrId\n      };\n\n      this._base.runAction('delete', \"/\" + this._urlEncodedNameOrId(), queryParams, null, function (err, response, results) {\n        if (err) {\n          done(err);\n          return;\n        }\n\n        var records = map_1.default(results.records, function (_a) {\n          var id = _a.id;\n          return new record_1.default(_this, id, null);\n        });\n        done(null, records);\n      });\n    } else {\n      var record = new record_1.default(this, recordIdsOrId);\n      record.destroy(done);\n    }\n  };\n\n  Table.prototype._listRecords = function (limit, offset, opts, done) {\n    var _this = this;\n\n    if (!done) {\n      done = opts;\n      opts = {};\n    }\n\n    var listRecordsParameters = assign_1.default({\n      limit: limit,\n      offset: offset\n    }, opts);\n\n    this._base.runAction('get', \"/\" + this._urlEncodedNameOrId() + \"/\", listRecordsParameters, null, function (err, response, results) {\n      if (err) {\n        done(err);\n        return;\n      }\n\n      var records = map_1.default(results.records, function (recordJson) {\n        return new record_1.default(_this, null, recordJson);\n      });\n      done(null, records, results.offset);\n    });\n  };\n\n  Table.prototype._forEachRecord = function (opts, callback, done) {\n    var _this = this;\n\n    if (arguments.length === 2) {\n      done = callback;\n      callback = opts;\n      opts = {};\n    }\n\n    var limit = Table.__recordsPerPageForIteration || 100;\n    var offset = null;\n\n    var nextPage = function nextPage() {\n      _this._listRecords(limit, offset, opts, function (err, page, newOffset) {\n        if (err) {\n          done(err);\n          return;\n        }\n\n        forEach_1.default(page, callback);\n\n        if (newOffset) {\n          offset = newOffset;\n          nextPage();\n        } else {\n          done();\n        }\n      });\n    };\n\n    nextPage();\n  };\n\n  return Table;\n}();\n\nmodule.exports = Table;","map":{"version":3,"sources":["../src/table.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar isArray_1 = __importDefault(require(\"lodash/isArray\"));\nvar isPlainObject_1 = __importDefault(require(\"lodash/isPlainObject\"));\nvar assign_1 = __importDefault(require(\"lodash/assign\"));\nvar forEach_1 = __importDefault(require(\"lodash/forEach\"));\nvar map_1 = __importDefault(require(\"lodash/map\"));\nvar deprecate_1 = __importDefault(require(\"./deprecate\"));\nvar query_1 = __importDefault(require(\"./query\"));\nvar record_1 = __importDefault(require(\"./record\"));\nvar callback_to_promise_1 = __importDefault(require(\"./callback_to_promise\"));\nvar Table = /** @class */ (function () {\n    function Table(base, tableId, tableName) {\n        if (!tableId && !tableName) {\n            throw new Error('Table name or table ID is required');\n        }\n        this._base = base;\n        this.id = tableId;\n        this.name = tableName;\n        // Public API\n        this.find = callback_to_promise_1.default(this._findRecordById, this);\n        this.select = this._selectRecords.bind(this);\n        this.create = callback_to_promise_1.default(this._createRecords, this);\n        this.update = callback_to_promise_1.default(this._updateRecords.bind(this, false), this);\n        this.replace = callback_to_promise_1.default(this._updateRecords.bind(this, true), this);\n        this.destroy = callback_to_promise_1.default(this._destroyRecord, this);\n        // Deprecated API\n        this.list = deprecate_1.default(this._listRecords.bind(this), 'table.list', 'Airtable: `list()` is deprecated. Use `select()` instead.');\n        this.forEach = deprecate_1.default(this._forEachRecord.bind(this), 'table.forEach', 'Airtable: `forEach()` is deprecated. Use `select()` instead.');\n    }\n    Table.prototype._findRecordById = function (recordId, done) {\n        var record = new record_1.default(this, recordId);\n        record.fetch(done);\n    };\n    Table.prototype._selectRecords = function (params) {\n        if (params === void 0) {\n            params = {};\n        }\n        if (arguments.length > 1) {\n            console.warn(\"Airtable: `select` takes only one parameter, but it was given \" + arguments.length + \" parameters. Use `eachPage` or `firstPage` to fetch records.\");\n        }\n        if (isPlainObject_1.default(params)) {\n            var validationResults = query_1.default.validateParams(params);\n            if (validationResults.errors.length) {\n                var formattedErrors = map_1.default(validationResults.errors, function (error) {\n                    return \"  * \" + error;\n                });\n                throw new Error(\"Airtable: invalid parameters for `select`:\\n\" + formattedErrors.join('\\n'));\n            }\n            if (validationResults.ignoredKeys.length) {\n                console.warn(\"Airtable: the following parameters to `select` will be ignored: \" + validationResults.ignoredKeys.join(', '));\n            }\n            return new query_1.default(this, validationResults.validParams);\n        }\n        else {\n            throw new Error('Airtable: the parameter for `select` should be a plain object or undefined.');\n        }\n    };\n    Table.prototype._urlEncodedNameOrId = function () {\n        return this.id || encodeURIComponent(this.name);\n    };\n    Table.prototype._createRecords = function (recordsData, optionalParameters, done) {\n        var _this = this;\n        var isCreatingMultipleRecords = isArray_1.default(recordsData);\n        if (!done) {\n            done = optionalParameters;\n            optionalParameters = {};\n        }\n        var requestData;\n        if (isCreatingMultipleRecords) {\n            requestData = { records: recordsData };\n        }\n        else {\n            requestData = { fields: recordsData };\n        }\n        assign_1.default(requestData, optionalParameters);\n        this._base.runAction('post', \"/\" + this._urlEncodedNameOrId() + \"/\", {}, requestData, function (err, resp, body) {\n            if (err) {\n                done(err);\n                return;\n            }\n            var result;\n            if (isCreatingMultipleRecords) {\n                result = body.records.map(function (record) {\n                    return new record_1.default(_this, record.id, record);\n                });\n            }\n            else {\n                result = new record_1.default(_this, body.id, body);\n            }\n            done(null, result);\n        });\n    };\n    Table.prototype._updateRecords = function (isDestructiveUpdate, recordsDataOrRecordId, recordDataOrOptsOrDone, optsOrDone, done) {\n        var _this = this;\n        var opts;\n        if (isArray_1.default(recordsDataOrRecordId)) {\n            var recordsData = recordsDataOrRecordId;\n            opts = isPlainObject_1.default(recordDataOrOptsOrDone) ? recordDataOrOptsOrDone : {};\n            done = optsOrDone || recordDataOrOptsOrDone;\n            var method = isDestructiveUpdate ? 'put' : 'patch';\n            var requestData = assign_1.default({ records: recordsData }, opts);\n            this._base.runAction(method, \"/\" + this._urlEncodedNameOrId() + \"/\", {}, requestData, function (err, resp, body) {\n                if (err) {\n                    done(err);\n                    return;\n                }\n                var result = body.records.map(function (record) {\n                    return new record_1.default(_this, record.id, record);\n                });\n                done(null, result);\n            });\n        }\n        else {\n            var recordId = recordsDataOrRecordId;\n            var recordData = recordDataOrOptsOrDone;\n            opts = isPlainObject_1.default(optsOrDone) ? optsOrDone : {};\n            done = done || optsOrDone;\n            var record = new record_1.default(this, recordId);\n            if (isDestructiveUpdate) {\n                record.putUpdate(recordData, opts, done);\n            }\n            else {\n                record.patchUpdate(recordData, opts, done);\n            }\n        }\n    };\n    Table.prototype._destroyRecord = function (recordIdsOrId, done) {\n        var _this = this;\n        if (isArray_1.default(recordIdsOrId)) {\n            var queryParams = { records: recordIdsOrId };\n            this._base.runAction('delete', \"/\" + this._urlEncodedNameOrId(), queryParams, null, function (err, response, results) {\n                if (err) {\n                    done(err);\n                    return;\n                }\n                var records = map_1.default(results.records, function (_a) {\n                    var id = _a.id;\n                    return new record_1.default(_this, id, null);\n                });\n                done(null, records);\n            });\n        }\n        else {\n            var record = new record_1.default(this, recordIdsOrId);\n            record.destroy(done);\n        }\n    };\n    Table.prototype._listRecords = function (limit, offset, opts, done) {\n        var _this = this;\n        if (!done) {\n            done = opts;\n            opts = {};\n        }\n        var listRecordsParameters = assign_1.default({\n            limit: limit,\n            offset: offset,\n        }, opts);\n        this._base.runAction('get', \"/\" + this._urlEncodedNameOrId() + \"/\", listRecordsParameters, null, function (err, response, results) {\n            if (err) {\n                done(err);\n                return;\n            }\n            var records = map_1.default(results.records, function (recordJson) {\n                return new record_1.default(_this, null, recordJson);\n            });\n            done(null, records, results.offset);\n        });\n    };\n    Table.prototype._forEachRecord = function (opts, callback, done) {\n        var _this = this;\n        if (arguments.length === 2) {\n            done = callback;\n            callback = opts;\n            opts = {};\n        }\n        var limit = Table.__recordsPerPageForIteration || 100;\n        var offset = null;\n        var nextPage = function () {\n            _this._listRecords(limit, offset, opts, function (err, page, newOffset) {\n                if (err) {\n                    done(err);\n                    return;\n                }\n                forEach_1.default(page, callback);\n                if (newOffset) {\n                    offset = newOffset;\n                    nextPage();\n                }\n                else {\n                    done();\n                }\n            });\n        };\n        nextPage();\n    };\n    return Table;\n}());\nmodule.exports = Table;\n//# sourceMappingURL=table.js.map"]},"metadata":{},"sourceType":"script"}